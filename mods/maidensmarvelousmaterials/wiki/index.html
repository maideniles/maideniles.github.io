<!DOCTYPE html>
<html lang="en" style="--purple: #8F84FD; --purple-gray: #686576; --light-gray: #f1f1f1; --gray: #d2d2d2; --dark-gray: #787878; --alt-gray: #767676; --alt-dark-gray: #505050;">
	<head>
		<script>let write = html => document.currentScript.insertAdjacentHTML('beforebegin', html);</script>
		<script src="/assets/libs/js/shml.js"></script>
		<title>Maideniles  - Maiden's Marvelous Materials Wiki</title>
		<meta charset="UTF-8">
		<link rel="apple-touch-icon" sizes="120x120" href="/assets/images/icons/apple-touch-icon.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/icons/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/icons/favicon-16x16.png">
		<link rel="manifest" href="/assets/images/icons/site.webmanifest">
		<link rel="mask-icon" href="/assets/images/icons/safari-pinned-tab.svg" color="#8f84fd">
		<link rel="shortcut icon" href="/assets/images/icons/favicon.ico">
		<meta name="msapplication-TileColor" content="#9f00a7">
		<meta name="msapplication-config" content="/assets/images/icons/browserconfig.xml">
		<meta name="theme-color" content="#ffffff">
		<meta name="description" content="Maiden's Marvelous Materials Wiki">
		<meta name="keywords" content="Maiden, Marvelous, Materials, Wiki">
		<meta name="author" content="Tim Wasinger">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="../../../assets/libs/css/w3-css-4.0.0.css">
		<link rel="stylesheet" href="../../../assets/libs/css/font-awesome-4.7.0.min.css">
		<style>
			html, body {
				width: 100%;
				margin: 0;
			}
			.background-image {
				height: 100%;
				width: 100vw;
				object-fit: cover;
				z-index: -1;
				position: fixed;
				top: 0;
				left: 0;
				filter: blur(3px) grayscale(5%);
			}
			.wiki-image, .download-image {
				max-width: 100%;
			}
			@media screen and (min-height: 700px) {
				.sidebar-fixed {
					position: fixed;
				}
			}
			.download-card {
				background-image: url("../../../assets/images/backgrounds/tile.png");
				background-size: 350px;
				backdrop-filter: blur(3px) grayscale(5%);
				max-width: 350px;
				width: calc(100% - 32px);
			}
			.w3-card {
				border-radius: 5px;
			}
			.purple-text {
				color: var(--purple);
			}
			.download-link {
				text-decoration: none;
				white-space: nowrap;
				text-shadow:
					-1px -1px 0 #fff,
					1px -1px 0 #fff,
					-1px 1px 0 #fff,
					1px 1px 0 #fff;
			}
			.download-icon {
				position: relative;
				left: -30px;
				top: 50px;	
			}
			.download-image {
				position: relative;
				left: 1em;
			}
			.discord-small {
				background-color: #7289da;
				color: white;
				font-family: Arial;
			}
			.discord-small a {
				text-decoration: none;
			}
			.vertical-margin-8px {
				margin-top: 8px;
				margin-bottom: 8px;
			}
			.bar {
				background-color: var(--purple);
				box-shadow: 0 2px 5px 0 rgba(0,0,0,0.16), 0 2px 10px 0 rgba(0,0,0,0.12);
				position: fixed;
			}
			.bar-item {
				text-decoration: none;
				cursor: pointer;
				font-weight: bold;
				font-size: larger;
				color: white;
			}
			.bar-search {
				border: none;
				outline: none;
				vertical-align: middle;
			}
			.logo {
				height: 43px;
			}
			.bar-item:hover {
				background-color: var(--gray);
				color: black;
			}
			.search-header {
				color: var(--purple);
			}
			.search-result {
				text-decoration: none;
				cursor: pointer;
				color: var(--alt-dark-gray);
				display: block;
			}
			details summary {
				cursor: pointer;
			}
			details summary::-webkit-details-marker {
				cursor: pointer;
			}
			.bar-placeholder {
				visibility: hidden;
			}
			.wiki-content h1 {
				font-size: 3.5em;
				font-weight: bold;
			}
			.wiki-content h2 {
				font-size: 3em;
				font-weight: bold;
			}
			.wiki-content h3 {
				font-size: 2.5em;
				font-weight: bold;
			}
			.wiki-content h4 {
				font-size: 2em;
				font-weight: bold;
			}
			.wiki-content h5 {
				font-size: 1.5em;
				font-weight: bold;
			}
			.wiki-content h6 {
				font-size: 1em;
				font-weight: bold;
			}
			@media (max-width:600px) {
				.search {
					max-width: 100px;
				}
			}
			.search {
				border-radius: 8px;
			}
			.wiki-content-list-item {
				display: block;
			}
		</style>
	</head>
	<body>
		<img class="background-image" src="images/trees.png">
		<div class="w3-bar bar">
			<a class="" href="?main:index"><img src="../../../assets/images/logo.png" class="logo w3-bar-item"></a>
			<div class="w3-hide-small">
			<a class="w3-bar-item bar-item" href="?main:index"><i class="fa fa-home"></i><span class="w3-hide-small"> Home</span></a>
			<a class="w3-bar-item bar-item" href="?special:random"><i class="fa fa-random"></i><span class="w3-hide-small"> Random Page</span></a>
			<a href="https://www.curseforge.com/minecraft/mc-mods/maidens-marvelous-materials/download" target="_blank" class="w3-bar-item bar-item"><i class="fa fa-download"></i><span class="w3-hide-small"> Download</span></a>
		</div>
			<a class="w3-right w3-bar-item bar-item" onclick="searchWiki()"><i class="fa fa-search"></i></a>
			<a class="w3-right w3-bar-item"><input id="search" name="search" type="text" placeholder="Search..." class="search bar-search" onkeydown="if(event.key === 'Enter') searchWiki()"></a>
		</div>
		<div class="w3-bar bar-placeholder">
			<img src="../../../assets/images/logo.png" class="logo w3-bar-item">
			<a class="w3-bar-item bar-item" href="?main:index"><i class="fa fa-home"></i><span class="w3-hide-small"> Home</span></a>
			<a class="w3-bar-item bar-item" href="?special:random"><i class="fa fa-random"></i><span class="w3-hide-small"> Random Page</span></a>
			<a href="https://www.curseforge.com/minecraft/mc-mods/maidens-marvelous-materials/download" target="_blank" class="w3-bar-item bar-item"><i class="fa fa-download"></i><span class="w3-hide-small"> Download</span></a>
			<a class="w3-right w3-bar-item bar-item" onclick="searchWiki()"><i class="fa fa-search"></i></a>
			<a class="w3-right w3-bar-item"><input type="text" placeholder="Search..." class="search bar-search" onkeydown="if(event.key === 'Enter') searchWiki()"></a>
		</div>

		<div id="modal" class="w3-modal" onclick="setModalDisplay('none')">
			<div class="w3-modal-content" onclick="event.stopPropagation();">
				<div class="w3-container">
				<span onclick="setModalDisplay('none')" class="w3-button w3-display-topright">&times;</span>
				<p class="w3-large search-header"><i class="fa fa-search"></i> Search Results</p>
				<div id="search-results" name="search-results" class="w3-margin"></div>
				</div>
			</div>
		</div>

		<div class="w3-row">
			<div class="w3-threequarter">
				<article>
					<div class="w3-card w3-white w3-margin w3-padding">
						<header class="wiki-header">
						
						</header>
						<img class="wiki-image">
						<div class="wiki-content-list">
							<h2><u>Contents</u></h2>
						</div>
					</div>
					<div class="w3-card w3-white w3-margin w3-padding">
						<section class="wiki-content">

						</section>
					</div>
				</article>
				<div class="w3-card w3-white w3-margin w3-padding">
					<h2>Other Articles</h2>
					<div class="wiki-pages">
					</div>
				</div>
			</div>
			<div class="w3-quarter">
				<div class="sidebar-fixed">
					<div class="w3-margin w3-hide-small">
						<iframe src="https://discord.com/widget?id=778673367926439966&theme=light" width="350" height="500" allowtransparency="true" frameborder="0" sandbox="allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts"></iframe>
					</div>
					<div class="w3-card w3-margin w3-padding w3-hide-medium w3-hide-large discord-small">
						<a target="_blank" href="https://discord.gg/d3P6JKay">
							<b class="w3-large vertical-margin-8px">JOIN THE SERVER</b>
							<img src="../../../assets/images/discord.svg">
						</a>
					</div>
					<a href="https://www.curseforge.com/minecraft/mc-mods/maidens-marvelous-materials/download" target="_blank" title="Download Official Mod" class="download-link w3-xlarge">
					<div class="w3-card w3-white w3-margin w3-padding download-card">
						<div class="w3-center purple-text w3-margin">
							<img src="../../../assets/images/logo.png" class="download-image"><i class="fa fa-download w3-jumbo download-icon"></i><br><br><b>Dowload</b>
						</div>
					</div>
					</a>
				</div>
			</div>
		</div>
		<script>
			let backgrounds = ['forest0.png', 'forest1.png', 'forest2.png', 'orchard0.png', 'beach0.png', 'beach1.png']
			document.querySelector('.background-image').src = '../../../assets/images/backgrounds/' + backgrounds[Math.floor(Math.random() * backgrounds.length)]
			let pageMap;
			async function loadWikiContent() {
				let args = window.location.search.substring(1).split(':');
				let category = args[0] ?? 'missingno';
				let entry = args[1] ?? 'missingno';
				
				if (category === 'special' && entry === 'random') {
					return void (window.location.search = '?' + getRandomPage());
				}
				let response = await fetch('pages/' + category + '/' + entry + '.txt');
				if (!response.ok) return void renderErrorPage(response);
				let text = await response.text();
				
				let result = SHML.parseMarkup(text);
				
				
				let title = (result.getProperty('title') ?? entry[0].toUpperCase() + entry.substring(1)).trim();
				let revisedOn = result.getProperty('revised');
				let image = (result.getProperty('picture') ?? '').trim();
				
				renderPage(title, category, result.toHTML(), revisedOn, image, result.getIds());
			}
			async function loadWikiPages() {
				let response = await fetch('pages/pages.txt');
				if (!response.ok) return {};
				let text = await response.text();
				let pages = {};
				for (let line of text.split('\n')) {
					line = line.trim();
					if(line === '' || line.startsWith('//')) continue;
					let args = line.split(';');
					let path = args[0].split(':');
					let category = path[0];
					if(pages[category] === undefined) pages[category] = {};
					pages[category][path[1]] = args[1];
				}
				return pages;
			}
			function renderPage(title, category, content, revisedOn, image, ids) {
				document.querySelector('.wiki-content').innerHTML = content;
				if (image !== '' && image !== undefined) document.querySelector('.wiki-image').src = 'images/' + image;
				let header = document.querySelector('.wiki-header');
				if (category !== undefined) header.innerHTML += '<p>in: ' + getCategoryName(category) + '</p>'
				header.innerHTML += '<h1 class="wiki-header-title">' + SHML.parseInlineMarkup(title).toHTML() + '</h1>';
				if (revisedOn !== undefined) header.innerHTML += '<p>Last Revised On: ' + revisedOn.trim(); + '</p>';
				document.title += ' (' + document.querySelector('.wiki-header-title').textContent + ')';
				document.querySelector('.wiki-content-list').innerHTML += ids.map(o => '<a class="wiki-content-list-item" href=#'+o+'>'+document.getElementById(o).innerHTML+'</a>').join('\n');
			}
			function renderOtherPages() {
				if (pageMap === undefined) return;
				let pages = document.querySelector('.wiki-pages');
				for (let category in pageMap) {
					let contents = [];
					for (let page in pageMap[category]) contents.push('<a href=?' + category + ':' + page + '>' + pageMap[category][page] + '</a>');
					pages.innerHTML += '<details><summary>' + getCategoryName(category) + '</summary>' + contents.join(' ') + '</details>';
				}
			}
			async function initWiki() {
				pageMap = JSON.parse(sessionStorage.getItem('pageMap') ?? null) ?? undefined;
				if (pageMap === undefined) {
					pageMap = await loadWikiPages();
					sessionStorage.setItem('pageMap', JSON.stringify(pageMap));
				}
				await loadWikiContent();
				renderOtherPages();
			}
			function getRandomPage() {
				if (pageMap === undefined) return 'missingno:missingno';
				let keys = Object.keys(pageMap);
				let category = keys[keys.length * Math.random() | 0];
				keys = Object.keys(pageMap[category]);
				let entry = keys[keys.length * Math.random() | 0];
				return category + ':' + entry;
			}
			function getCategoryName(category) {
				return pageMap?.[category]?.index ?? category;
			}
			function renderErrorPage(response) {
				renderPage('Error Loading Page', undefined, `An error has occurred while loading the page.<br><code>Status Code: ${response.status}<br>Ok: ${response.ok}<br>Details: ${response.statusText}</code>`, undefined, 'error.png', []);
			}
			initWiki();
			function searchWiki() {
				let results = [];
				let query = document.querySelector('#search').value;
				for (let word of query.replace(/[^a-zA-Z\d]/g, ' ').trim().toLowerCase().split(' ').map(o => o.replace(/[\s]/, ''))) {
					for (let category in pageMap) {
						let catMatch = levenshteinDistance(word, category) < 4 || levenshteinDistance(word, getCategoryName(category)) < 4;
						for (let page in pageMap[category]) if(catMatch || levenshteinDistance(word, page) < 4 || levenshteinDistance(word, pageMap[category][page]) < 4) results.push(category + ':' + page);
					}
					if ((levenshteinDistance(word, 'random') < 4 || levenshteinDistance(word, 'random') < 4) && !results.includes('special:random')) results.push('special:random');
				}
				let modal = document.getElementById('search-results');
				modal.innerHTML = '';
				if(results.length === 0) modal.innerHTML = '<a class="search-result">No Results ╯︿╰</a>';
				for(let result of results)
					modal.innerHTML += '<a class="search-result" href="?' + result + '" title="' + result + '">' + result + '</a>';
				setModalDisplay('block');
			}
			function levenshteinDistance(str1 = '', str2 = '') {
				const track = Array(str2.length + 1).fill(null).map(() =>
				Array(str1.length + 1).fill(null));
				for (let i = 0; i <= str1.length; i += 1)
					track[0][i] = i;
				for (let j = 0; j <= str2.length; j += 1)
					track[j][0] = j;
				for (let j = 1; j <= str2.length; j += 1) {
					for (let i = 1; i <= str1.length; i += 1) {
						const indicator = str1[i - 1] === str2[j - 1] ? 0 : 1;
						track[j][i] = Math.min(
							track[j][i - 1] + 1, // deletion
							track[j - 1][i] + 1, // insertion
							track[j - 1][i - 1] + indicator, // substitution
						);
					}
				}
				return track[str2.length][str1.length];
			}
			function setModalDisplay(display) {
				document.getElementById('modal').style.display = display;
			}
		</script>
	</body>
</html>